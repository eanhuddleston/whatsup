<div class="row">
<div class="span7">
  <h4>Events within <%= @distance %> miles</h4>
  <div id="map" style="width: 500px; height: 400px;"></div>
</div> <!-- left column -->

<div class="span3">
  <h4>Narrow Search By:</h4>

  <%= form_tag home_url, :method => :get do %>
      <%= text_field_tag :distance %>
      Miles From Home
      <br>
      <% @avail_categories.each do |category| %>
        <%= check_box_tag(
              "categories[]",
              category.id,
              @selected_categories.include?(category)
            )
        %>
      <%= category.name %><br>
    <% end %>
    <%= hidden_field_tag :prev_distance, @distance %>
    <br>
    <%= submit_tag "Search" %>

  <% end %>
</div> <!-- right column -->

</div> <!-- first row -->
<div class="row">
  <div class="span5">
<% @trimmed_events.each do |event| %>
  <div data-eventid="<%=event.id%>"><%= link_to event.title, event %> (<%= event.distance.round(2) %> miles)</div>
<% end %>
  </div>
</div>
<br>
<%= link_to "Add Event", new_event_url %>
<br>
<%= link_to "All Events", events_url %>

<script src="http://maps.google.com/maps/api/js?sensor=false&v=3.11" 
    type="text/javascript"></script>

<script type="text/javascript">
google.maps.event.addDomListener(window, 'load', initialize);

window.user_loc = <%= @user_loc.to_json.html_safe %>
window.events_within_range = <%= @events_within_range.to_json.html_safe %>
window.trimmed_events = <%= @trimmed_events.to_json.html_safe %>

</script>